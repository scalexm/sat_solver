#! /bin/bash


if [ "$(expr substr $(uname -s) 1 5)" == "Linux" ]; then
    timer=timeout
else #Assuming mac OS
    timer=gtimeout
fi

param=( -moms -dlis -rand)

allparam=('no flags' -moms -dlis -rand -wl -cl '-wl -vsids' '-cl -wl -vsids')
for x in ${param[@]}; do
    allparam+=("-wl $x")
    allparam+=("-cl $x")
    allparam+=("-wl -cl $x")
    allparam+=("-cl $x -forget")
    allparam+=("-wl -cl $x -forget")
done;

output=$(date "+%d-%m-%y_%H:%M:%S.log")
commande=../bin/resol
cflags=""
temps=20s
echo "========== Sans flags =============" > "$output"
for x in *.cnf; do
    echo "/////// $x //////// " >> "$output"
    ligne=$($timer $temps $commande $x 2>&1)
    result=$(echo "$ligne" | grep SAT)
    parse=$(echo "$ligne" | grep parse)
    solve=$(echo "$ligne" | grep solve)
    if [ -n "$result" ]; then
        echo $result >> "$output"
    else
        echo TIME LIMIT EXEEDED >> "$output"
    fi
    echo $parse  >> "$output"
    echo $solve  >> "$output"
done ;

for cflags in "${allparam[@]}" ; do
    echo "========== Avec $cflags =============" >> "$output"
    for x in *.cnf; do
        echo " ////// $x /////// " >> "$output"
        ligne=$($timer $temps $commande $x 2>&1)
        result=$(echo "$ligne" | grep SAT)
        parse=$(echo "$ligne" | grep parse)
        solve=$(echo "$ligne" | grep solve)
        if [ -n "$result" ]; then
            echo $result >> "$output"
        else
            echo TIME LIMIT EXEEDED >> "$output"
        fi
        echo $parse  >> "$output"
        echo $solve  >> "$output"
    done ;
done ;
